# 天文データ機能について

## 概要
明治11年(1878年)5月5日〜6月7日の日照条件と月の様子をリアルタイムで表示する機能を実装しました。

## 実装内容

### 1. 新規ファイル: `js/astronomyData.js`
天文データ（日出・日入・月出・月入・月齢）を管理するファイルです。

#### 主要な機能:
- **ASTRONOMY_DATA**: 34日分の天文データを格納
- **getAstronomyConditions(date)**: 指定された日時の天文条件を取得
  - 日照状態（夜明け前/日中/日没後）
  - 月の可視状態（見える/見えない）
  - 月相（新月、三日月、上弦の月、満月など）
  - 月齢
- **getMoonPhase(moonAge)**: 月齢から月相を判定
- **getMoonPhaseName(phase, lang)**: 月相の名称を取得（日本語/英語対応）
- **getMoonPhaseEmoji(phase)**: 月相の絵文字を取得

### 2. 更新ファイル: `js/timeControl.js`
時系列スライダーに連動して天文条件を更新する機能を追加しました。

#### 追加機能:
- **updateAstronomyDisplay(currentDate, lang)**: 天文条件の表示を更新
  - 日照状態のテキスト表示
  - 月の状態と月相の表示（絵文字付き）
  - 詳細情報（日出・日入・月出・月入の時刻）

### 3. 更新ファイル: `index.html`
- `astronomyData.js`のスクリプト読み込みを追加
- 天文条件表示エリア（`astronomy-display`）を追加

### 4. 更新ファイル: `style.css`
天文条件表示のスタイルを追加:
- デスクトップ版: タイムラインの上部に表示（半透明で控えめ）
- モバイル版: タイムラインの上部に表示（画面幅に合わせて調整）

## 表示内容

### 日照状態
- **夜明け前** (Before Sunrise): 日の出前
- **日中** (Daytime): 日の出〜日の入りの間
- **日没後** (After Sunset): 日の入り後

### 月の状態
月が見える場合:
- 月相の絵文字（🌑〜🌕）
- 月相の名称（新月、三日月、上弦の月、満月など）
- 月齢（日数）

月が見えない場合:
- "月は見えません" (Moon not visible)

### 詳細情報
- 日の出時刻
- 日の入時刻
- 月の出時刻
- 月の入時刻

## データの仕様

### CSVからの変換
元のCSVデータ:
```csv
日付,日の出 (JST),日の入 (JST),月齢（概算・日）,月の出（近似, JST）,月の入（近似, JST）
1878-05-05,04:57,18:40,2.94,08:52,19:09
```

JavaScriptオブジェクト形式:
```javascript
{ 
  date: '1878-05-05', 
  sunrise: '04:57', 
  sunset: '18:40', 
  moonAge: 2.94, 
  moonrise: '08:52', 
  moonset: '19:09' 
}
```

### 月齢と月相の対応
- 0〜1.84日: 🌑 新月 (New Moon)
- 1.84〜7.38日: 🌒 三日月 (Waxing Crescent)
- 7.38〜9.23日: 🌓 上弦の月 (First Quarter)
- 9.23〜14.77日: 🌔 十三夜月 (Waxing Gibbous)
- 14.77〜16.61日: 🌕 満月 (Full Moon)
- 16.61〜22.15日: 🌖 十六夜月 (Waning Gibbous)
- 22.15〜23.99日: 🌗 下弦の月 (Last Quarter)
- 23.99〜29.5日: 🌘 二十六夜月 (Waning Crescent)

## 使い方

1. **時系列スライダーを動かす**: 日時が変わると自動的に天文条件が更新されます
2. **言語切り替え**: 日本語/英語の切り替えに対応
3. **自動再生**: 再生ボタンを押すと、時間経過に応じて天文条件も更新されます

## 今後の拡張案

- 天文条件に応じた地図の背景色変更（夜間は暗く）
- 月相に応じたアイコン表示の工夫
- 天文イベント（日の出、日の入り、月の出、月の入り）の通知機能
- より詳細な天文情報（薄明時刻、天体高度など）の追加

## 技術的な注意点

1. **日付の跨ぎ**: 月の出入りが日を跨ぐ場合は自動的に調整されます
2. **データの範囲**: 1878年5月5日〜6月7日のみ対応（範囲外は不明扱い）
3. **時刻の精度**: データは分単位で記録されています
4. **JST表記**: すべての時刻は日本標準時（JST）です
